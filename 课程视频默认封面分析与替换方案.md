# ğŸ¬ è¯¾ç¨‹è§†é¢‘é»˜è®¤å°é¢åˆ†æä¸æ›¿æ¢æ–¹æ¡ˆ

## ğŸ” **å½“å‰è§†é¢‘å°é¢æœºåˆ¶åˆ†æ**

### 1. é‡è¦å‘ç°
ç»è¿‡æ·±å…¥åˆ†æï¼Œå‘ç°äº†è¿™ä¸ªé¡¹ç›®è§†é¢‘å°é¢çš„çœŸå®æƒ…å†µï¼š

**è¿™ä¸ªé¡¹ç›®æ²¡æœ‰ç‹¬ç«‹çš„è§†é¢‘å°é¢åŠŸèƒ½ï¼**

### 2. è§†é¢‘å°é¢æ¥æºåˆ†æ

#### **è…¾è®¯äº‘VODè§†é¢‘**ï¼š
- **è‡ªåŠ¨ç”Ÿæˆ**ï¼šè…¾è®¯äº‘VODåœ¨è½¬ç å®Œæˆåä¼šè‡ªåŠ¨ç”Ÿæˆè§†é¢‘å°é¢å¸§
- **å­˜å‚¨ä½ç½®**ï¼šå°é¢å›¾ç‰‡å­˜å‚¨åœ¨è…¾è®¯äº‘COSä¸­
- **è·å–æ–¹å¼**ï¼šé€šè¿‡è…¾è®¯äº‘VOD APIè·å–åª’ä½“ä¿¡æ¯ï¼ŒåŒ…å«å°é¢URL
- **æ˜¾ç¤ºæœºåˆ¶**ï¼šå‰ç«¯æ’­æ”¾å™¨è‡ªåŠ¨ä½¿ç”¨è…¾è®¯äº‘æä¾›çš„å°é¢

#### **å¤–é“¾è§†é¢‘**ï¼š
- **æ— å°é¢æ”¯æŒ**ï¼šå¤–é“¾è§†é¢‘é»˜è®¤æ²¡æœ‰å°é¢åŠŸèƒ½
- **æ’­æ”¾å™¨è¡Œä¸º**ï¼šæ˜¾ç¤ºé»‘å±æˆ–è§†é¢‘ç¬¬ä¸€å¸§
- **å¯æ‰©å±•æ€§**ï¼šå¯ä»¥é€šè¿‡ä¿®æ”¹ `file_remote` ç»“æ„æ·»åŠ å°é¢æ”¯æŒ

### 3. é»˜è®¤å°é¢æ–‡ä»¶ä½ç½®

#### **è¯¾ç¨‹å°é¢ï¼ˆéè§†é¢‘ï¼‰**ï¼š
```
ä½ç½®ï¼špublic/static/admin/img/default/course_cover.png
ç”¨é€”ï¼šè¯¾ç¨‹æœ¬èº«çš„å°é¢ï¼Œä¸æ˜¯è§†é¢‘å°é¢
å°ºå¯¸ï¼š400x300åƒç´ 
```

#### **å…¶ä»–é»˜è®¤å°é¢**ï¼š
```
article_cover.png  - æ–‡ç« å°é¢
package_cover.png  - å¥—é¤å°é¢  
topic_cover.png    - ä¸“é¢˜å°é¢
vip_cover.png      - ä¼šå‘˜å°é¢
gift_cover.png     - ç¤¼å“å°é¢
slide_cover.png    - è½®æ’­å›¾å°é¢
```

**æ³¨æ„**ï¼šè¿™äº›éƒ½æ˜¯å„ç§å†…å®¹ç±»å‹çš„é»˜è®¤å°é¢ï¼Œä¸æ˜¯è§†é¢‘æ’­æ”¾å™¨çš„å°é¢ï¼

## ğŸš€ **è§†é¢‘å°é¢æ›¿æ¢è§£å†³æ–¹æ¡ˆ**

### æ–¹æ¡ˆä¸€ï¼šè…¾è®¯äº‘VODè§†é¢‘å°é¢æ›¿æ¢

#### 1.1 è…¾è®¯äº‘VODå°é¢æœºåˆ¶
è…¾è®¯äº‘VODä¼šè‡ªåŠ¨ä¸ºè§†é¢‘ç”Ÿæˆå°é¢ï¼Œå­˜å‚¨ç»“æ„ï¼š
```json
{
  "MediaInfoSet": [{
    "BasicInfo": {
      "CoverUrl": "https://xxx.vod2.myqcloud.com/xxx/xxx.jpg"
    }
  }]
}
```

#### 1.2 æ›¿æ¢æ–¹æ³•
**æ–¹æ³•1ï¼šé€šè¿‡è…¾è®¯äº‘æ§åˆ¶å°**
1. ç™»å½•è…¾è®¯äº‘VODæ§åˆ¶å°
2. æ‰¾åˆ°å¯¹åº”è§†é¢‘
3. ç¼–è¾‘è§†é¢‘ä¿¡æ¯
4. ä¸Šä¼ æ–°çš„å°é¢å›¾ç‰‡

**æ–¹æ³•2ï¼šé€šè¿‡APIæ›¿æ¢**
```php
// ä½¿ç”¨è…¾è®¯äº‘VOD APIä¿®æ”¹è§†é¢‘å°é¢
$vodService = new VodService();
$vodService->modifyMediaInfo($fileId, [
    'CoverData' => base64_encode(file_get_contents($newCoverPath))
]);
```

**æ–¹æ³•3ï¼šé‡æ–°å¤„ç†è§†é¢‘**
```php
// å‘èµ·è§†é¢‘å¤„ç†ä»»åŠ¡ï¼Œç”Ÿæˆæ–°çš„å°é¢æˆªå›¾
$vodService->processMedia($fileId, [
    'MediaProcessTask' => [
        'SnapshotByTimeOffsetTaskSet' => [
            [
                'Definition' => 10,
                'TimeOffsetSet' => [5.0]  // åœ¨ç¬¬5ç§’æˆªå–å°é¢
            ]
        ]
    ]
]);
```

### æ–¹æ¡ˆäºŒï¼šå¤–é“¾è§†é¢‘å°é¢æ·»åŠ 

#### 2.1 æ‰©å±•file_remoteç»“æ„
```json
{
  "hd": {"url": "é«˜æ¸…è§†é¢‘åœ°å€"},
  "sd": {"url": "æ ‡æ¸…è§†é¢‘åœ°å€"},
  "fd": {"url": "æµç•…è§†é¢‘åœ°å€"},
  "duration": {"hours": 0, "minutes": 45, "seconds": 0},
  "cover": {
    "url": "http://192.168.1.24:9000/course-files/video-covers/cover.jpg",
    "width": 640,
    "height": 360
  }
}
```

#### 2.2 å‰ç«¯æ’­æ”¾å™¨æ”¯æŒ
ä¿®æ”¹è§†é¢‘æ’­æ”¾å™¨ï¼Œæ”¯æŒposterå±æ€§ï¼š
```html
<video id="video-player" 
       poster="{{ chapter.vod.file_remote.cover.url ?? '' }}"
       controls>
    <source src="{{ video_url }}" type="video/mp4">
</video>
```

### æ–¹æ¡ˆä¸‰ï¼šç»Ÿä¸€è§†é¢‘å°é¢ç®¡ç†

#### 3.1 æ·»åŠ è§†é¢‘å°é¢å­—æ®µ
```sql
-- ä¸ºè§†é¢‘ç« èŠ‚æ·»åŠ ç‹¬ç«‹çš„å°é¢å­—æ®µ
ALTER TABLE kg_chapter_vod 
ADD COLUMN video_cover VARCHAR(500) DEFAULT '' COMMENT 'è§†é¢‘å°é¢URL' 
AFTER file_remote;
```

#### 3.2 å°é¢ä¼˜å…ˆçº§é€»è¾‘
```php
public function getVideoCover($chapterId) {
    $vod = $this->getChapterVod($chapterId);
    
    // ä¼˜å…ˆçº§ï¼šè‡ªå®šä¹‰å°é¢ > å¤–é“¾å°é¢ > è…¾è®¯äº‘å°é¢ > é»˜è®¤å°é¢
    if (!empty($vod->video_cover)) {
        return $vod->video_cover;  // è‡ªå®šä¹‰å°é¢
    }
    
    if (!empty($vod->file_remote['cover']['url'])) {
        return $vod->file_remote['cover']['url'];  // å¤–é“¾å°é¢
    }
    
    if (!empty($vod->file_id)) {
        return $this->getTencentCover($vod->file_id);  // è…¾è®¯äº‘å°é¢
    }
    
    return '/static/img/default/video_cover.jpg';  // é»˜è®¤å°é¢
}
```

## ğŸ’» **å®ç”¨è„šæœ¬**

### è„šæœ¬1ï¼šæ‰¹é‡è·å–è…¾è®¯äº‘è§†é¢‘å°é¢
```php
<?php
// get_tencent_video_covers.php
```

### è„šæœ¬2ï¼šæ‰¹é‡è®¾ç½®è§†é¢‘å°é¢
```php
<?php  
// set_video_covers.php
```

### è„šæœ¬3ï¼šè§†é¢‘å°é¢æå–å·¥å…·
```php
<?php
// extract_video_frames.php
```

## ğŸ”§ **å‰ç«¯æ’­æ”¾å™¨å°é¢æ”¯æŒ**

### 1. HTML5 Videoå°é¢
```html
<!-- åŸºç¡€HTML5æ’­æ”¾å™¨ -->
<video poster="{{ video_cover_url }}" controls>
    <source src="{{ video_url }}" type="video/mp4">
</video>
```

### 2. è‡ªå®šä¹‰æ’­æ”¾å™¨å°é¢
```javascript
// è‡ªå®šä¹‰æ’­æ”¾å™¨å°é¢æ˜¾ç¤º
function initVideoPlayer(videoUrl, coverUrl) {
    var player = document.getElementById('video-player');
    
    if (coverUrl) {
        player.poster = coverUrl;
    }
    
    // æ’­æ”¾å‰æ˜¾ç¤ºå°é¢
    player.addEventListener('loadstart', function() {
        if (coverUrl && !player.played.length) {
            player.style.backgroundImage = `url(${coverUrl})`;
            player.style.backgroundSize = 'cover';
        }
    });
}
```

### 3. æ’­æ”¾å™¨æ’ä»¶æ‰©å±•
```javascript
// ä¸ºç°æœ‰æ’­æ”¾å™¨æ·»åŠ å°é¢æ”¯æŒ
if (window.TCPlayer) {
    // è…¾è®¯äº‘æ’­æ”¾å™¨
    var player = TCPlayer('video-container', {
        fileID: fileId,
        appID: appId,
        poster: coverUrl  // è®¾ç½®å°é¢
    });
}
```

## ğŸ“‹ **é»˜è®¤å°é¢æ›¿æ¢æ–¹æ¡ˆ**

### 1. æ›¿æ¢ç³»ç»Ÿé»˜è®¤å°é¢

#### 1.1 è¯¾ç¨‹é»˜è®¤å°é¢
```bash
# æ›¿æ¢è¯¾ç¨‹é»˜è®¤å°é¢
cp your-new-cover.png public/static/admin/img/default/course_cover.png
```

#### 1.2 åˆ›å»ºè§†é¢‘é»˜è®¤å°é¢
```bash
# åˆ›å»ºè§†é¢‘ä¸“ç”¨é»˜è®¤å°é¢
cp your-video-cover.png public/static/admin/img/default/video_cover.png
```

### 2. æ‰¹é‡ä¸Šä¼ åˆ°è…¾è®¯äº‘COS
```php
// æ‰¹é‡ä¸Šä¼ é»˜è®¤å°é¢åˆ°è…¾è®¯äº‘
$uploadService = new UploadService();

$covers = [
    'course_cover.png' => '/img/default/course_cover.png',
    'video_cover.png' => '/img/default/video_cover.png',
    // æ›´å¤šå°é¢...
];

foreach ($covers as $localFile => $cosPath) {
    $uploadService->uploadFile($localFile, $cosPath);
}
```

## ğŸ¯ **æ¨èå®æ–½æ­¥éª¤**

### é˜¶æ®µä¸€ï¼šäº†è§£ç°çŠ¶ï¼ˆ10åˆ†é’Ÿï¼‰
1. **æ£€æŸ¥è…¾è®¯äº‘VOD**ï¼šç™»å½•æ§åˆ¶å°æŸ¥çœ‹è§†é¢‘å°é¢
2. **æŸ¥çœ‹æ’­æ”¾å™¨**ï¼šç¡®è®¤å½“å‰æ’­æ”¾å™¨å°é¢æ˜¾ç¤ºæƒ…å†µ
3. **åˆ†æéœ€æ±‚**ï¼šç¡®å®šè¦æ›¿æ¢å“ªäº›è§†é¢‘çš„å°é¢

### é˜¶æ®µäºŒï¼šè…¾è®¯äº‘è§†é¢‘å°é¢å¤„ç†ï¼ˆ30åˆ†é’Ÿï¼‰
1. **æ‰¹é‡è·å–**ï¼šä½¿ç”¨è„šæœ¬è·å–æ‰€æœ‰è§†é¢‘çš„å°é¢ä¿¡æ¯
2. **åˆ¶ä½œæ–°å°é¢**ï¼šå‡†å¤‡æ–°çš„å°é¢å›¾ç‰‡
3. **æ‰¹é‡æ›¿æ¢**ï¼šé€šè¿‡APIæˆ–æ§åˆ¶å°æ‰¹é‡æ›¿æ¢

### é˜¶æ®µä¸‰ï¼šå¤–é“¾è§†é¢‘å°é¢æ·»åŠ ï¼ˆ1å°æ—¶ï¼‰
1. **æ‰©å±•æ•°æ®ç»“æ„**ï¼šåœ¨ `file_remote` ä¸­æ·»åŠ å°é¢æ”¯æŒ
2. **ä¿®æ”¹å‰ç«¯æ˜¾ç¤º**ï¼šæ›´æ–°æ’­æ”¾å™¨æ”¯æŒå°é¢
3. **æ‰¹é‡è®¾ç½®**ï¼šä¸ºå¤–é“¾è§†é¢‘è®¾ç½®å°é¢

### é˜¶æ®µå››ï¼šç»Ÿä¸€å°é¢ç®¡ç†ï¼ˆå¯é€‰ï¼‰
1. **æ·»åŠ ç®¡ç†ç•Œé¢**ï¼šåœ¨åå°æ·»åŠ è§†é¢‘å°é¢ç®¡ç†
2. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**ï¼šæ”¯æŒå°é¢é¢„è§ˆã€æ‰¹é‡æ“ä½œ
3. **è‡ªåŠ¨åŒ–å¤„ç†**ï¼šè‡ªåŠ¨ä»è§†é¢‘ä¸­æå–å°é¢å¸§

## âš ï¸ **é‡è¦è¯´æ˜**

### 1. è§†é¢‘å°é¢ vs è¯¾ç¨‹å°é¢
- **è¯¾ç¨‹å°é¢**ï¼šè¯¾ç¨‹æœ¬èº«çš„å°é¢å›¾ç‰‡ï¼ˆå·²å­˜åœ¨ï¼‰
- **è§†é¢‘å°é¢**ï¼šè§†é¢‘æ’­æ”¾å™¨æ˜¾ç¤ºçš„å°é¢å›¾ç‰‡ï¼ˆéœ€è¦æ·»åŠ ï¼‰
- **ä¸¤è€…ç‹¬ç«‹**ï¼šäº’ä¸å½±å“ï¼Œå¯ä»¥åˆ†åˆ«è®¾ç½®

### 2. è…¾è®¯äº‘VODå°é¢ç‰¹ç‚¹
- **è‡ªåŠ¨ç”Ÿæˆ**ï¼šä¸Šä¼ è§†é¢‘åè‡ªåŠ¨ç”Ÿæˆ
- **å¯ä»¥æ›¿æ¢**ï¼šæ”¯æŒé€šè¿‡APIæˆ–æ§åˆ¶å°æ›¿æ¢
- **å¤šç§å°ºå¯¸**ï¼šæ”¯æŒå¤šç§åˆ†è¾¨ç‡çš„å°é¢

### 3. å¤–é“¾è§†é¢‘å°é¢é™åˆ¶
- **éœ€è¦æ‰©å±•**ï¼šåŸç³»ç»Ÿä¸æ”¯æŒï¼Œéœ€è¦å¼€å‘
- **æ’­æ”¾å™¨å…¼å®¹**ï¼šéœ€è¦ç¡®ä¿æ’­æ”¾å™¨æ”¯æŒposterå±æ€§
- **å­˜å‚¨ä½ç½®**ï¼šå»ºè®®å­˜å‚¨åœ¨åŒä¸€æœåŠ¡å™¨æˆ–CDN

## ğŸ”§ **æŠ€æœ¯å®ç°è¦ç‚¹**

### 1. è…¾è®¯äº‘VODå°é¢è·å–
```php
public function getVodCover($fileId) {
    $vodService = new VodService();
    $mediaInfo = $vodService->getMediaInfo($fileId);
    
    if (isset($mediaInfo['MediaInfoSet'][0]['BasicInfo']['CoverUrl'])) {
        return $mediaInfo['MediaInfoSet'][0]['BasicInfo']['CoverUrl'];
    }
    
    return null;
}
```

### 2. è§†é¢‘å°é¢æˆªå–
```php
public function extractVideoFrame($videoPath, $timeOffset = 5) {
    $outputPath = tempnam(sys_get_temp_dir(), 'video_cover_') . '.jpg';
    
    $command = "ffmpeg -i '{$videoPath}' -ss {$timeOffset} -vframes 1 '{$outputPath}'";
    exec($command, $output, $returnCode);
    
    if ($returnCode === 0 && file_exists($outputPath)) {
        return $outputPath;
    }
    
    return false;
}
```

### 3. æ’­æ”¾å™¨å°é¢è®¾ç½®
```javascript
function setVideoPlayerCover(playerId, coverUrl) {
    var player = document.getElementById(playerId);
    
    if (player && coverUrl) {
        player.poster = coverUrl;
        
        // ç¡®ä¿å°é¢æ­£ç¡®æ˜¾ç¤º
        player.load();
    }
}
```

## ğŸ“Š **æ•ˆæœéªŒè¯**

### 1. è…¾è®¯äº‘è§†é¢‘
- [ ] åœ¨VODæ§åˆ¶å°æŸ¥çœ‹å°é¢å·²æ›´æ–°
- [ ] æ’­æ”¾å™¨æ˜¾ç¤ºæ–°å°é¢
- [ ] ç§»åŠ¨ç«¯æ’­æ”¾å™¨å°é¢æ­£å¸¸

### 2. å¤–é“¾è§†é¢‘
- [ ] æ•°æ®åº“ä¸­ `file_remote` åŒ…å«å°é¢ä¿¡æ¯
- [ ] æ’­æ”¾å™¨æ˜¾ç¤ºå¤–é“¾å°é¢
- [ ] å°é¢é“¾æ¥å¯ä»¥æ­£å¸¸è®¿é—®

### 3. æ•´ä½“æ•ˆæœ
- [ ] æ‰€æœ‰è§†é¢‘éƒ½æœ‰åˆé€‚çš„å°é¢
- [ ] å°é¢åŠ è½½é€Ÿåº¦æ­£å¸¸
- [ ] ä¸åŒè®¾å¤‡æ˜¾ç¤ºä¸€è‡´

---

**æ€»ç»“**ï¼šè¿™ä¸ªé¡¹ç›®åŸæœ¬æ²¡æœ‰ç‹¬ç«‹çš„è§†é¢‘å°é¢åŠŸèƒ½ï¼Œè…¾è®¯äº‘VODä¼šè‡ªåŠ¨ç”Ÿæˆå°é¢ï¼Œå¤–é“¾è§†é¢‘éœ€è¦æ‰‹åŠ¨æ·»åŠ æ”¯æŒã€‚é€šè¿‡ä»¥ä¸Šæ–¹æ¡ˆï¼Œå¯ä»¥å®ç°å®Œæ•´çš„è§†é¢‘å°é¢ç®¡ç†åŠŸèƒ½ã€‚