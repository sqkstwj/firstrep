# ğŸ“¸ è¯¾ç¨‹å°é¢å¤–é“¾ä¸Šä¼ æ–¹æ¡ˆ

## ğŸ” **å½“å‰å°é¢ä¸Šä¼ æœºåˆ¶åˆ†æ**

### 1. ç°æœ‰ä¸Šä¼ æµç¨‹
```
å‰ç«¯é¡µé¢ â†’ ç‚¹å‡»"æ›´æ¢"æŒ‰é’® â†’ Layuiä¸Šä¼ ç»„ä»¶ â†’ /admin/upload/cover/img â†’ è…¾è®¯äº‘COS â†’ è¿”å›URL
```

### 2. å…³é”®æ–‡ä»¶åˆ†æ
- **å‰ç«¯**: `edit_basic.volt` - å°é¢æ˜¾ç¤ºå’Œæ›´æ¢æŒ‰é’®
- **JavaScript**: `cover.upload.js` - å¤„ç†ä¸Šä¼ é€»è¾‘
- **åç«¯**: `UploadController::uploadCoverImageAction()` - ä¸Šä¼ æ¥å£
- **å­˜å‚¨**: è…¾è®¯äº‘COSå­˜å‚¨ï¼Œè·¯å¾„æ ¼å¼ï¼š`/img/cover/xxx.jpg`
- **æ•°æ®åº“**: `kg_course.cover` å­—æ®µå­˜å‚¨ç›¸å¯¹è·¯å¾„

### 3. å°é¢å¤„ç†æœºåˆ¶
```php
// ä¿å­˜æ—¶ï¼šå¦‚æœæ˜¯å®Œæ•´URLï¼Œæå–è·¯å¾„éƒ¨åˆ†
beforeSave() {
    if (Text::startsWith($this->cover, 'http')) {
        $this->cover = self::getCoverPath($this->cover);  // æå–è·¯å¾„
    }
}

// è¯»å–æ—¶ï¼šå¦‚æœä¸æ˜¯å®Œæ•´URLï¼Œæ‹¼æ¥è…¾è®¯äº‘åŸŸå
afterFetch() {
    if (!Text::startsWith($this->cover, 'http')) {
        $this->cover = kg_cos_course_cover_url($this->cover);  // æ‹¼æ¥åŸŸå
    }
}
```

## ğŸš€ **å¤–é“¾ä¸Šä¼ è§£å†³æ–¹æ¡ˆ**

### æ–¹æ¡ˆä¸€ï¼šä¿®æ”¹å‰ç«¯æ”¯æŒå¤–é“¾è¾“å…¥ï¼ˆæ¨èï¼‰

#### 1.1 ä¿®æ”¹ç¼–è¾‘é¡µé¢æ¨¡æ¿
```html
<!-- åœ¨ edit_basic.volt ä¸­æ·»åŠ å¤–é“¾è¾“å…¥é€‰é¡¹ -->
<div class="layui-form-item">
    <label class="layui-form-label">å°é¢</label>
    <div class="layui-input-inline">
        <img id="img-cover" class="kg-cover" src="{{ course.cover }}">
        <input type="hidden" name="cover" value="{{ course.cover }}">
    </div>
    <div class="layui-input-inline" style="padding-top:35px;">
        <button id="change-cover" class="layui-btn layui-btn-sm" type="button">ä¸Šä¼ </button>
        <button id="external-cover" class="layui-btn layui-btn-sm layui-btn-normal" type="button">å¤–é“¾</button>
    </div>
</div>
```

#### 1.2 æ·»åŠ å¤–é“¾è¾“å…¥JavaScript
```javascript
// æ·»åŠ åˆ° cover.upload.js æˆ–åˆ›å»ºæ–°çš„ JS æ–‡ä»¶
$('#external-cover').click(function() {
    layer.prompt({
        title: 'è¯·è¾“å…¥å°é¢å›¾ç‰‡å¤–é“¾åœ°å€',
        formType: 2, // æ–‡æœ¬åŸŸ
        area: ['500px', '150px'],
        value: $('input[name=cover]').val()
    }, function(value, index) {
        if (value && (value.startsWith('http://') || value.startsWith('https://'))) {
            $('#img-cover').attr('src', value);
            $('input[name=cover]').val(value);
            layer.close(index);
            layer.msg('å°é¢å¤–é“¾è®¾ç½®æˆåŠŸ', {icon: 1});
        } else {
            layer.msg('è¯·è¾“å…¥æœ‰æ•ˆçš„HTTP/HTTPSé“¾æ¥', {icon: 2});
        }
    });
});
```

### æ–¹æ¡ˆäºŒï¼šæ•°æ®åº“ç›´æ¥æ‰¹é‡æ›´æ–°

#### 2.1 åˆ›å»ºæ‰¹é‡æ›´æ–°è„šæœ¬
```php
<?php
// course_cover_external.php
```

### æ–¹æ¡ˆä¸‰ï¼šåå°ç®¡ç†æ‰©å±•

#### 3.1 æ·»åŠ å°é¢ç®¡ç†é¡µé¢
åœ¨åå°æ·»åŠ ä¸“é—¨çš„å°é¢ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒï¼š
- æ‰¹é‡ä¸Šä¼ å°é¢
- å¤–é“¾å¯¼å…¥
- å°é¢é¢„è§ˆå’Œç®¡ç†

## ğŸ“‹ **æ¨èå®æ–½æ­¥éª¤**

### ğŸ¯ **å¿«é€Ÿæ–¹æ¡ˆï¼šæ•°æ®åº“ç›´æ¥æ›´æ–°**

æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ›´æ–°å°é¢å­—æ®µï¼š

```sql
-- ç›´æ¥è®¾ç½®è¯¾ç¨‹å°é¢ä¸ºMinIOå¤–é“¾
UPDATE kg_course 
SET cover = 'http://192.168.1.24:9000/course-files/covers/course-1.jpg' 
WHERE id = 1;

-- æ‰¹é‡æ›´æ–°å¤šä¸ªè¯¾ç¨‹å°é¢
UPDATE kg_course 
SET cover = CONCAT('http://192.168.1.24:9000/course-files/covers/course-', id, '.jpg')
WHERE id IN (1,2,3,4,5);
```

### ğŸ”§ **å®Œæ•´æ–¹æ¡ˆï¼šå‰ç«¯æ”¯æŒå¤–é“¾**

å¦‚æœéœ€è¦åœ¨åå°ç•Œé¢æ”¯æŒå¤–é“¾è¾“å…¥ï¼Œéœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç ã€‚

## ğŸ’» **å®ç”¨è„šæœ¬**

### è„šæœ¬1ï¼šè¯¾ç¨‹å°é¢å¤–é“¾æ‰¹é‡è®¾ç½®
```php
<?php
// è®¾ç½®è¯¾ç¨‹å°é¢ä¸ºMinIOå¤–é“¾
```

### è„šæœ¬2ï¼šå°é¢é“¾æ¥æµ‹è¯•å·¥å…·
```php
<?php
// æµ‹è¯•å°é¢é“¾æ¥æ˜¯å¦å¯è®¿é—®
```

## âš ï¸ **æ³¨æ„äº‹é¡¹**

### 1. URLæ ¼å¼è¦æ±‚
- **æ”¯æŒæ ¼å¼**: `http://` æˆ– `https://` å¼€å¤´çš„å®Œæ•´URL
- **å­˜å‚¨æ–¹å¼**: ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼Œå®Œæ•´URLåœ¨ä¿å­˜æ—¶æå–è·¯å¾„ï¼Œè¯»å–æ—¶æ‹¼æ¥åŸŸå
- **å…¼å®¹æ€§**: å¤–é“¾URLä¼šç›´æ¥å­˜å‚¨å’Œä½¿ç”¨ï¼Œä¸ç»è¿‡è…¾è®¯äº‘å¤„ç†

### 2. å›¾ç‰‡è¦æ±‚
- **æ ¼å¼**: JPG, PNG, GIFç­‰å¸¸è§å›¾ç‰‡æ ¼å¼
- **å°ºå¯¸**: å»ºè®® 400x300 åƒç´ æˆ–ç­‰æ¯”ä¾‹
- **å¤§å°**: å»ºè®®ä¸è¶…è¿‡2MB
- **è®¿é—®**: ç¡®ä¿å¤–é“¾å›¾ç‰‡å¯ä»¥å…¬å¼€è®¿é—®

### 3. ç³»ç»Ÿå…¼å®¹æ€§
- **ç°æœ‰æœºåˆ¶**: å®Œå…¨å…¼å®¹ç°æœ‰çš„è…¾è®¯äº‘COSä¸Šä¼ 
- **æ··åˆä½¿ç”¨**: å¯ä»¥åŒæ—¶ä½¿ç”¨æœ¬åœ°ä¸Šä¼ å’Œå¤–é“¾
- **æ•°æ®è¿ç§»**: ä¸å½±å“ç°æœ‰è¯¾ç¨‹çš„å°é¢æ˜¾ç¤º

## ğŸ¯ **å¿«é€Ÿå¼€å§‹**

### æœ€ç®€å•çš„æ–¹æ³•ï¼š
1. **å‡†å¤‡å°é¢å›¾ç‰‡**: ä¸Šä¼ åˆ°MinIOæˆ–å…¶ä»–å›¾åºŠ
2. **è·å–å¤–é“¾åœ°å€**: ç¡®ä¿å¯ä»¥å…¬å¼€è®¿é—®
3. **æ•°æ®åº“æ›´æ–°**: ä½¿ç”¨SQLç›´æ¥æ›´æ–°
4. **éªŒè¯æ•ˆæœ**: åœ¨å‰å°æŸ¥çœ‹å°é¢æ˜¾ç¤º

### SQLç¤ºä¾‹ï¼š
```sql
-- æ›´æ–°å•ä¸ªè¯¾ç¨‹å°é¢
UPDATE kg_course 
SET cover = 'http://192.168.1.24:9000/course-files/covers/medical-equipment.jpg'
WHERE id = 1;

-- æŸ¥çœ‹æ›´æ–°ç»“æœ
SELECT id, title, cover FROM kg_course WHERE id = 1;
```

éœ€è¦æˆ‘ä¸ºæ‚¨åˆ›å»ºå…·ä½“çš„å®æ–½è„šæœ¬å—ï¼Ÿ